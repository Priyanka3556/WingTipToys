@using WingTipToys.Models
@model HomeViewModel
@{
    var carProducts = Model.CarProducts;
    var searchedData = Model.SearchProducts;
}

<html class="js no-flexbox flexbox-legacy canvas canvastext webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths"
      lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <title>Cars - Wingtip Toys</title>
    <link href="Assets/Site.css" rel="stylesheet">
</head>

<body>
<form action="SearchProducts" id="ctl01" method="post" name="ctl01">
<header>
    <div class="content-wrapper">
        <div class="float-left">
            <p class="site-title">
                <a href="/" id="A2">
                    <img id="Logo"
                         src="Assets/logo.jpg" style="border-style: None;">
                </a>
            </p>
        </div>
    </div>
</header>
<div id="body">
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h1>Products</h1>
            </hgroup>
            <div class="content-wrapper">
                <input type="text" class="" name="searchCriteria" id="productSearch" value="" data-validate-use-tooltip="true"
                       data-validate-tooltip-placement="bottom" autocomplete="off" placeholder="Enter product to search"
                       spellcheck="false" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;">
                <button id="submitSearch" type="submit" class="btn btn-primary">Search</button>
            </div>
            <section class="featured">
                <table>
                    <tr>
                        @if (searchedData != null)
                        {
                            <td style="width: 50%;">
                                <h1 style="margin-left: 14px;">Search Products</h1>
                                @if (!searchedData.IsSuccess)
                                {
                                    <p style="margin-left: 3%;color: red;">No result found for your search criteria</p>
                                }

                                <div style="margin-left: 2em">
                                    @if (searchedData.Products.Any())
                                    {
                                        <table>
                                            <tr>
                                                <td>
                                                    <table>
                                                        @foreach (var car in searchedData.Products)
                                                        {
                                                            <tr>
                                                                <td hidden=@car.ProductID name="ProductId"></td>
                                                                <td>
                                                                    @car.ProductName
                                                                </td>
                                                            </tr>
                                                        }

                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    }
                                </div>
                            </td>
                        }
                    </tr>
                </table>
            </section>
            <section class="featured">
                <table>
                    <tr>
                        <td style=" width: 50%;">
                            <div style="margin-left: 2em">
                                <table>
                                    <tr>
                                        <td style="width: 30%; vertical-align: top;">
                                            <hgroup class="title">
                                                <h1>Wingtip Toys</h1>
                                                <h2>Wingtip Toys can help you find the perfect gift</h2>
                                            </hgroup>
                                            <p style="margin-top: -173px;">
                                                We're all about transportation toys. You can order
                                                any of our toys today. Each toy listing has detailed
                                                information to help you choose the right toy.
                                            </p>
                                        </td>
                                        <td>
                                            <table>
                                                <tr>
                                                    <td>
                                                        <img border="1" height="75" src="Assets/carconvert.png" width="100">
                                                    </td>
                                                    <td>
                                                        Convertible Car
                                                        <br>
                                                        <span class="ProductPrice">
                                                            <strong>Price:</strong>
                                                            $22.50
                                                        </span>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td>
                                                        <img border="1" height="75" src="Assets/carearly.png" width="100">
                                                    </td>
                                                    <td>
                                                        Old-time Car
                                                        <br>
                                                        <span class="ProductPrice">
                                                            <strong>Price:</strong>
                                                            $15.95
                                                        </span>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td>
                                                        <img border="1" height="75" src="Assets/carfast.png" width="100">
                                                    </td>
                                                    <td>
                                                        Fast Car
                                                        <br>
                                                        <span class="ProductPrice">
                                                            <strong>Price:</strong>
                                                            $32.99
                                                        </span>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td>
                                                        <img border="1" height="75" src="Assets/carfaster.png" width="100">
                                                    </td>
                                                    <td>
                                                        Super Fast Car
                                                        <br>
                                                        <span class="ProductPrice">
                                                            <strong>Price:</strong>
                                                            $8.95
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                        </td>
                        <td style="width: 50%;">
                            <h1 style="margin-left: 14px;">Car Products</h1>
                            <div style="margin-left: 2em">
                                <table>
                                    <tr>
                                        <td>
                                            <table>
                                                @if (Model.CarProducts != null && Model.CarProducts.Any())
                                                {
                                                    for (int i = 0; i < Model.CarProducts.Count; i++)
                                                    {
                                                        <tr>
                                                            @Html.HiddenFor(m => m.CarProducts[i].ProductID)
                                                            <td hidden=@Model.CarProducts[i].ProductID name="ProductId"></td>
                                                            <td>
                                                                @Html.HiddenFor(m => m.CarProducts[i].ImagePath)
                                                                <input type="checkbox" name="check" Id=@Model.CarProducts[i].ProductID value=@Model.CarProducts[i].ProductID>
                                                                <img border="1" height="75" src="Assets/@Model.CarProducts[i].ImagePath" width="100">
                                                            </td>
                                                            <td>
                                                                @Html.HiddenFor(m => m.CarProducts[i].ProductName)
                                                                @Model.CarProducts[i].ProductName
                                                                <br>
                                                                <span class="ProductPrice">
                                                                    <strong>Price:</strong>
                                                                    @Html.HiddenFor(m => m.CarProducts[i].UnitPrice)
                                                                    $@Model.CarProducts[i].UnitPrice
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                                <input type="button" id="btn_click" value="Add To Cart" />
                                                <div id="addToCartError" style="margin-left: 3%;color: red;display: none">Please select atleast one item</div>
                                                <div id="addToCartSuccess" style="margin-left: 3%;color: red;display: none">Data Updated</div>
                                            </table>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                        </td>
                    </tr>
                </table>
            </section>
        </div>
    </section>

    <section class="content-wrapper main-content clear-fix"></section>
</div>

<footer>
    <div class="content-wrapper">
        <div class="float-left">
            <p>OrderDynamics Coding Exercise</p>
        </div>
    </div>
</footer>
</form>

<script type="text/javascript">
    $('#btn_click').click(function() {

        $("#addToCartError").css("display", "none");
        var chekItems = [];
        $("input:checkbox[name=check]:checked").each(function() {
            chekItems.push($(this).attr("id"));
        });

        if (chekItems.length >= 1) {
            $.ajax({
                url: '@Url.Action("AddToCart", "Home")',
            dataType: "json",
            type: "POST",            
            cache: false,
                data: { items: chekItems} ,
            success: function (resp) {
                if (resp.success) {
                    $('input[name="check"]').each(function() {
                        this.checked = false;
                    });
                    $("#addToCartSuccess").html("Data Updated Succesfully");
                    $("#addToCartSuccess").show();
                    setTimeout(function() {
                        $("#addToCartSuccess").hide();
                    }, 10000);
                }
            },
            error: function (xhr) {
                $('input[name="check"]').each(function() {
                        this.checked = false;
                });
                $("#addToCartSuccess").html("Error while updating");
                $("#addToCartSuccess").show();
                    
            }
        });
        }
        if($("input:checkbox[name=check]:checked").length<=0)
        {
            $("#addToCartError").css("display", "block");
        }
    });
</script>
</body>
</html>

